<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Questioner | User | Meetup</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/user/meetup.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
        crossorigin="anonymous">


    <link rel="stylesheet" href="../css/responsive.css">
</head>

<body>
    <div id="loader-overlay">
        <div class="loader"></div>
    </div>

    <header class="header">
        <h1 class="header-logo"><a href="../index.html"><span class="q">Q</span><span class="uestioner">UESTIONER</span>
            </a> </h1>

        <div class="profile"> <a href="#"><img id="dropdown" src="../img/coming (2).jpeg" alt="">Seyi</a>
            <br> <span class="time" id="currentTime"></span>
        </div>

        <div class="dropdown" id="dropdownNav">
            <ul>
                <li><a href="./index.html">Meetups</a></li>
                <li> <a href="../user/profile.html">Profile</a> </li>
                <li> <a href="../user/reset-password.html">Setting</a> </li>
                <li> <a href="../index.html">Logout</a> </li>
            </ul>
        </div>

    </header>


    <section class="container">
        <div class="body-wrapper">
            <div class="container-page">
                <div class="topic-list-header">MEETUP</div>
                <div class="meetup-list" id="single-meetup">
                    <section id="single-meetup-detail">

                    </section>

                    <hr>
                    <h3 class="details">Interested People (12)</h3>
                    <section class="attendees">

                        <div class="attend-block">
                            <img class="attendees" src="../img/coming(1).jpeg" alt="">
                            <p>Oluwaseyi</p>
                        </div>
                        <div class="attend-block">
                            <img class="attendees" src="../img/coming (2).jpeg" alt="">
                            <p>Christian</p>
                        </div>
                        <div class="attend-block">
                            <img class="attendees" src="../img/coming (4).jpeg" alt="">
                            <p>Kemi</p>
                        </div>
                        <div class="attend-block">
                            <img class="attendees" src="../img/coming(4).jpg" alt="">
                            <p>Valetyy</p>
                        </div>



                    </section>
                    <section>
                        <hr>
                        <h3 class="details">RSVP</h3>
                        <form action="" id="rsvpForm" class="RSVPdiv">
                            <label class="radioContainer">
                                <input type="radio" name="rsvp" id="">
                                <span class="checkmark"></span>Attending
                            </label>
                            <label class="radioContainer">
                                <input type="radio" checked name="rsvp" id="">Not Sure
                                <span class="checkmark"></span>
                            </label>
                            <label class="radioContainer">Not
                                <input type="radio" name="rsvp" id="">Attending
                                <span class="checkmark"></span>
                            </label>
                            <input type="submit" value="RSVP" class="submitButton">
                        </form>
                    </section>
                    <hr>

                    <h3 class="details">Discussion</h3>
                    <div class="discussion">
                        <p class="successDiv" id="quesSuccessDiv"></p>
                        <p class="errorDiv" id=questionError></p>
                        <button class="submitButton" id="askQuestionButton">ASK QUESTION <i class="far fa-question-circle fa-1x"></i></button>

                        <form action="#" id="postQuestionForm">


                            <input type="text" name="title" placeholder="Question title here" class="form-control question-title">

                            <textarea contenteditable="true" name="body" placeholder=" Question Body Here" id="post-question"
                                class="quesstion-textarea"></textarea>
                            <br><button class="submitButton">Submit</button>
                        </form>
                        <div class="QCDiv" id="questions-list">

                            <div class="questionDiv"><span>Question by<a href="#"> Adebajo Oluwaseyi </a>on July 4,
                                    2018</span>
                                <br> Not sure if Digital Ocean will prefer me to say this here, but we go through
                                Cloudways
                                to have Digital Ocean instances for web hosting. I can't say enough good things about
                                this
                                setup! DO's performance will blow your doors off compared to typical shared hosting or
                                slow
                                VPS plans. And Cloudways' server config makes management secure and easy. Pricing is
                                gooddd
                                too. Especially compared to AWS and GCE which are crazy high.
                                <p>

                                    <a href="#"><i class="far fa-comment fa-1x"></i>(3)</a> |

                                    <a href="#" id="upvote"><i class="far fa-thumbs-up fa-1x"></i> (21)</a> |

                                    <a href="#" id="downvote"><i class="far fa-thumbs-down "></i> (3)</a></p>
                            </div>

                            <div class="commentDiv"><span>Comment by <a href="#">Emmnuel Tega</a> on July 5, 2018</span>
                                <br>
                                good things about this
                                setup! DO's performance will blow your doors off compared to typical shared hosting or
                                slow
                                VPS plans. And Cloudways' server config makes management secure and easy. Pricing is
                                good
                            </div>
                            <div class="commentDiv"><span>Comment by <a href="#">Olaiyiwola Ojo</a> on July 7, 2018</span>
                                <br>
                                good things about this
                                setup! DO's performance will blow your doors off compared to typical shared hosting or
                                slow
                                VPS plans. And Cloudways' server config makes management secure and easy. Pricing is
                                good
                            </div>
                            <div class="commentDiv"><span>Comment by <a href="#">Blessing Emeka </a> on July 8, 2018</span>
                                <br>
                                gend food things about this
                                setup! DO's performance will blow your doors off compared to typical shared hosting or
                                slow
                                VPS plans. And Cloudways' server config makes management secure and easy. Pricing is
                                good
                            </div>
                            <form  action="#" name="postCommentForm" id="postCommentForm">
                                <textarea name="post-comment-textarea" class="post-comment-textarea" placeholder="Comment on  Adebajo Oluwaseyi's  Question"></textarea>
                                <input type="submit" id="input"  value="Comment" class="submitButton commentButton" onsubmit="e.preventDefault(); alert('asdfgh')">

                            </form>
                        </div>

                        <div class="QCDiv">

                            <div class="questionDiv"><span>Question by<a href="#"> Emeka Onyeneke </a>on July 2, 2018</span>
                                <br> Not sure if Digital Ocean will prefer me to say this here, but we go through
                                Cloudways
                                to have Digital Ocean instances for web hosting. I can't say enough good things about
                                this
                                setup! DO's performance will blow your doors off compared to typical shared hosting or
                                slow
                                VPS plans. And Cloudways' server config makes management secure and easy. Pricing is
                                good
                                too. Especially compared to AWS and GCE which are crazy high.
                                <p><a href="#"><i class="far fa-comment fa-1x"></i>(0)</a> | <a href="#"><i class="far fa-thumbs-up fa-1x"></i>
                                        (4)</a> | <a href="#"><i class="far fa-thumbs-down "></i> (1)</a></p>
                            </div>
                            <div id="ask-question-div">

                            </div>
                        </div>
                    </div>
                </div>
                `
            </div>


        </div>





        </div>
        <aside class="aside">
            <div class="aside-header">
                Upcoming Meetups</div>
            <div class="aside-body">
                <div class="aside-content upcoming-meetup">
                    <p> Today: <span> 0</span></p>
                    <p> This Week:<span> 23</span></p>
                    <p> This Month:<span> 123</span></p>
                </div>

            </div>

            <div class="aside-header">
                ADVERTS</div>
            <div class="aside-body">
                <img src="https://i.imgur.com/XaKeYJE.png" alt="advert">
            </div>


        </aside>
        </div>
    </section>
    <footer class="footer">
        copyright @ Adebajo Oluwaseyi | Andela 2018
    </footer>
    <script>
        /* redirect page back to home page if login token is not present */
        // const token = JSON.parse(localStorage.getItem('token'))
        // if(!token){
        //     window.location.href = "../index.html"

        // }


        /* Get current logged in user detail */
        let user = JSON.parse(localStorage.getItem('user'));
        console.log(user);

        // get current page meetup Id
        let meetupId = new URLSearchParams(window.location.search).get('id');

        /* Populate current page with single meetup */
        fetch(`${localStorage.getItem('base_url')}/meetups/${meetupId}`, {
                headers: {
                    'content-type': 'text/plain',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                }
            })
            .then(response => response.json())
            .then(meetup => {
                if (meetup.status === 200) {
                    // data.map(data=>{
                    document.querySelector('#single-meetup-detail').innerHTML =
                        `
                        <div class="meetup-detail">
                                    <div class="meetup-banner"> <img src="../img/unity3d.jpeg" alt="">
                                    </div>
                                <div>
                                <h1 class="h1">${meetup.data[0].topic}</h1>
                                <div></div>
                                <p ><span class="bold"><i class="far fa-calendar"></i> Date:</span>    <span class="brown">${meetup.data[0].happeningon}</span>    </p>
                                <p><span class="bold"> <i class="fa fa-map-marker-alt"></i> Location:</span><span class="brown">${meetup.data[0].location}Lagos</span> </p>
                                <p ><span class="bold"> <i class="fa fa-user"></i> Host: </span>    <span class="brown">${meetup.data[0].host}</span>    </p>
                                <div><span class="bold"> <i class="fa fa-question-circle"></i> Question:</span>  <span class="brown"> ${meetup.data[0].qcount} </span>  <span class="bold"><br> <i class="fa fa-check"></i> RSVPS: </span><span class="brown"> ${meetup.data[0].rsvpcount}</span> </div>
                                </div>
                            </div>
                                                <br>
                            
                            
                            
                            <div class="details">
                            <h3>Details</h3>
                            <div>
                            ${meetup.data[0].details}
                            
                            
                            </div>
                            </div>
                        `
                    // })
                } else {
                    alert('wrong login credential');
                    `Bearer ${localStorage.getItem('token')}`
                }


            })
            .catch(error => console.log(error));


        /* Get All Questions of the current meetup */

        fetch(`${localStorage.getItem('base_url')}/meetups/${meetupId}/questions`, {
                headers: {
                    'content-type': 'text/plain',
                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                }
            })
            .then(response => response.json())
            .then(question => {
                if (question.status === 200) {
                    // console.log(data);
                    question.data.map(question => {
                        document.querySelector('#questions-list').innerHTML +=
                            `
                                <div class="questionDiv "><span>Question by<a href="#"> ${question.firstname} </a>on ${question.createdon}</span>
                                <br> ${question.title}<br>
                                ${question.body}
                               <p>

                                    <p>

                                <a href="#"><i class="far fa-comment fa-1x"></i>(3)</a> |

                                <a href="#" id="upvote"><i class="far fa-thumbs-up fa-1x"></i> (21)</a> |

                                <a href="#" id="downvote"><i class="far fa-thumbs-down "></i> (3)</a></p>
                                   
                            </div>
                            <div id='comments-list-${question.id}'>
                                
                            </div>
                            <div>
                                <form action="" class='postCommentForm' id=commentForm${question.id}> 
                                    <textarea name="post-comment-textarea" class="post-comment-textarea" placeholder="Comment on ${question.firstname} Question"></textarea>
                                    <input type="submit" value="Comment" class="submitButton commentButton">
                                </form>   
                            </div>
                                `

                        /* Get All comments of the current question */

                        fetch(`${localStorage.getItem('base_url')}/questions/${question.id}/comments`, {
                                headers: {
                                    'content-type': 'text/plain',
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`,
                                }
                            })
                            .then(response => response.json())
                            .then(comment => {

                                comment.data.map(comment => {
                                        document.querySelector(
                                                `#comments-list-${comment.questionid}`).innerHTML +=
                                            `
                                <div class="commentDiv"><span>Comment by <a href="#">${comment.firstname}</a> on ${comment.createdon}</span>
                                <br>
                                ${comment.body}
                            </div>

                                `
                                    }

                                )


                            })

                    })
                    // } else {
                    //     alert('wrong login credential');
                    //     `Bearer ${localStorage.getItem('token')}`
                }


            })
            .catch(error => console.log(error));

      

        /* post question to current meetup */
        document.querySelector('#postQuestionForm').addEventListener('submit', e => {

            e.preventDefault();
            let formData = new URLSearchParams(new FormData(e.target));
            // console.log(formData);
            formData.append('meetupId', meetupId),
                formData.append('userId', user.id)


            fetch(`${localStorage.getItem('base_url')}/questions`, {
                    method: "Post",
                    body: formData,
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`,
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 201) {
                        document.getElementById('quesSuccessDiv').innerHTML = null;
                        // data.message.forEach(error => {
                        document.getElementById('quesSuccessDiv').innerHTML +=
                            `
                        <li>${data.message}</li>`

                    } else {
                        document.getElementById('questionError').innerHTML = null;
                        data.error.forEach(error => {
                            document.getElementById('questionError').innerHTML +=
                                `
                        
                        <li>${error}</li>
                        `;
                        });
                    }
                })
                .catch(error => console.log(error));

        })



        
        document.querySelector('#rsvpForm').addEventListener('submit', e => {

e.preventDefault();
let formData = new URLSearchParams(new FormData(e.target));
// console.log(formData);
formData.append('meetupId', meetupId),
    formData.append('userId', user.id)


fetch(`${localStorage.getItem('base_url')}/questions`, {
        method: "Post",
        body: formData,
        headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`,
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 201) {
            document.getElementById('quesSuccessDiv').innerHTML = null;
            // data.message.forEach(error => {
            document.getElementById('quesSuccessDiv').innerHTML +=
                `
            <li>${data.message}</li>`

        } else {
            document.getElementById('questionError').innerHTML = null;
            data.error.forEach(error => {
                document.getElementById('questionError').innerHTML +=
                    `
            
            <li>${error}</li>
            `;
            });
        }
    })
    .catch(error => console.log(error));

})




       
    </script>
    <script src="../js/general.js"></script>
    <script src="../js/user.js"></script>
</body>